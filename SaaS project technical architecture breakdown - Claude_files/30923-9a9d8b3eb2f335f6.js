try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="4fc30d1a-7d9e-423d-9f5c-8bc66925e93a",e._sentryDebugIdIdentifier="sentry-dbid-4fc30d1a-7d9e-423d-9f5c-8bc66925e93a")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30923],{0xbdad302d:(e,t,n)=>{n.d(t,{$D:()=>v,Ey:()=>h,I5:()=>y,Oo:()=>I,QJ:()=>g,Z1:()=>R,ct:()=>T,eG:()=>S,gn:()=>m,oz:()=>_,pC:()=>A,ts:()=>M});var s=n(0xf32c56dd),r=n(0x12c9046cd),i=n(0x14de19ae8),a=n(0x49fac030),o=n(0xac309a83),u=n(0xe670e093),c=n(0x22f291c2a),l=n(0x17e725145),d=n(0xfc89b4a4),p=n(0x21687185c),f=n(0xe6c3f31e);function g(){return(0,o.fS)("yukon_gold")}let v=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,i.YL)(),s=null==n?void 0:n.uuid;return(0,r.Sk)("/v1/sessions",{queryKey:[a.Rv,{orgUuid:s}],enabled:!!n&&e,staleTime:3e4,refetchInterval:t,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...s?{"x-organization-uuid":s}:{}}})};function h(e,t,n){let s=e;if(t.length>0||n.length>0){let r="<uploaded_files>\n"+[...n.map(e=>"<file><file_path>".concat(e.path||e.file_name,"</file_path></file>")),...t.map(e=>{let t="<file_path>".concat(e.path||e.file_name,"</file_path>"),n=e.file_uuid?"<file_uuid>".concat(e.file_uuid,"</file_uuid>"):"";return"<file>".concat(t).concat(n,"</file>")})].join("\n")+"\n</uploaded_files>";s="".concat(r,"\n\n").concat(e)}return s}function y(e,t){return{uuid:(0,u.b)(),session_id:t,type:"user",parent_tool_use_id:null,message:{role:"user",content:e}}}let m=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/v1/sessions/".concat(e),{queryKey:[a.Ex,{orgUuid:n,sessionId:e}],enabled:!!t,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...n?{"x-organization-uuid":n}:{}}})};function _(){let e=b();return(0,d.useCallback)(t=>{let{title:n,customPrompt:s,model:r,gitRepoUrl:i,gitBranch:a,environmentId:o,mcpConfig:u,mcpTools:c}=t,l=[],d=[];return i&&a&&(l.push({type:"git_repository",url:i}),d.push({type:"git_repository",git_info:{type:"github",repo:i.split("github.com/")[1],branches:[a]}})),e.mutateAsync({title:n,environment_id:o,session_context:{sources:l,outcomes:d,mcp_config:u,mcp_tools:c,...void 0!==s?{custom_system_prompt:s}:{},...void 0!==r?{model:r}:{}}})},[e])}let b=()=>{let{activeOrganization:e}=(0,i.YL)(),t=(0,l.useQueryClient)(),n=null==e?void 0:e.uuid;return(0,r.L2)("/v1/sessions","POST",{onMutate:e=>{var s;if("config_id"in e&&"yukon_gold"===e.config_id)throw Error("Invalid config_id; use the other hook");let r=[a.Rv,{orgUuid:n}],i=t.getQueryData(r),o=null==i||null==(s=i.data.find(e=>e.id.startsWith("immediate-temp-")))?void 0:s.id,u=o||"temp-".concat(Date.now());if(i&&!o){let n={type:"session",id:u,title:e.title||"New session",session_status:"running",environment_id:e.environment_id,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),session_context:e.session_context||{sources:[],outcomes:[]}};t.setQueryData(r,{...i,data:[n,...i.data]})}return{previousSessions:i,tempSessionId:u}},onSuccess:(e,s,r)=>{let i=[a.Rv,{orgUuid:n}];t.setQueryData(i,t=>{let n;if(!t)return t;let s=t.data.some(t=>t.id===e.id),i=t.data.some(e=>e.id===(null==r?void 0:r.tempSessionId));return n=s&&i?t.data.filter(e=>e.id!==(null==r?void 0:r.tempSessionId)):s?t.data:i?t.data.map(t=>t.id===(null==r?void 0:r.tempSessionId)?e:t):[e,...t.data],{...t,data:n}})},onError:(e,s,r)=>{let i=[a.Rv,{orgUuid:n}];(null==r?void 0:r.previousSessions)&&t.setQueryData(i,r.previousSessions)},meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...n?{"x-organization-uuid":n}:{}}})};function S(){let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)("/api/organizations/".concat(t,"/dust/generate_title_and_branch"),"POST")}function w(e,t){return{onMutate:async n=>{let s=[a.Rv,{orgUuid:e}],r=[a.Ex,{orgUuid:e,sessionId:n.sessionId}];await Promise.all([t.cancelQueries({queryKey:s}),t.cancelQueries({queryKey:r})]);let i=t.getQueryData(s),o=t.getQueryData(r);return t.setQueryData(s,e=>e?{...e,data:e.data.map(e=>e.id===n.sessionId?{...e,...n.optimisticUpdate}:e)}:e),t.setQueryData(r,e=>e?{...e,...n.optimisticUpdate}:e),{previousSessionsList:i,previousSession:o}},onError:(n,s,r)=>{(null==r?void 0:r.previousSessionsList)&&t.setQueryData([a.Rv,{orgUuid:e}],r.previousSessionsList),(null==r?void 0:r.previousSession)&&t.setQueryData([a.Ex,{orgUuid:e,sessionId:s.sessionId}],r.previousSession)},onSuccess:(n,s)=>{t.setQueryData([a.Rv,{orgUuid:e}],e=>e?{...e,data:e.data.map(e=>e.id===s.sessionId?n:e)}:e),t.setQueryData([a.Ex,{orgUuid:e,sessionId:s.sessionId}],n)}}}function I(){let{activeOrganization:e}=(0,i.YL)(),t=(0,l.useQueryClient)(),n=null==e?void 0:e.uuid,s=w(n,t);return(0,r.L2)(e=>"/v1/sessions/".concat(e.sessionId),"PATCH",{transformVariables:e=>({title:e.title,session_status:e.session_status}),onMutate:e=>s.onMutate({sessionId:e.sessionId,optimisticUpdate:e}),onError:s.onError,onSuccess:s.onSuccess,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...n?{"x-organization-uuid":n}:{}}})}function A(){let{activeOrganization:e}=(0,i.YL)(),t=(0,l.useQueryClient)(),n=null==e?void 0:e.uuid,s=w(n,t);return(0,r.L2)(e=>"/v1/sessions/".concat(e.sessionId,"/archive"),"POST",{transformVariables:()=>({}),onMutate:e=>s.onMutate({sessionId:e.sessionId,optimisticUpdate:{session_status:"archived"}}),onError:s.onError,onSuccess:s.onSuccess,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...n?{"x-organization-uuid":n}:{}}})}let x=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s="/v1/sessions/ws/".concat(t,"/subscribe"),r=new URLSearchParams;r.append("organization_uuid",e),n.replay&&r.append("replay","true");let i=r.toString();i&&(s+="?".concat(i));let a="https:"===window.location.protocol?"wss:":"ws:";return"".concat(a,"//").concat(window.location.host).concat(s)},E=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,i.YL)(),s=null==n?void 0:n.uuid;return(0,r.Sk)("/v1/sessions/".concat(e,"/events"),{queryKey:[a.ri,{orgUuid:s,sessionId:e}],enabled:!!n&&t,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29",...s?{"x-organization-uuid":s}:{}}})};class L{[Symbol.asyncIterator](){if(this.started)throw Error("Stream can only be iterated once");return this.started=!0,this}next(){return this.queue.length>0?Promise.resolve({done:!1,value:this.queue.shift()}):this.isDone?Promise.resolve({done:!0,value:void 0}):this.hasError?Promise.reject(this.hasError):new Promise((e,t)=>{this.readResolve=e,this.readReject=t})}enqueue(e){if(this.readResolve){let t=this.readResolve;this.readResolve=void 0,this.readReject=void 0,t({done:!1,value:e})}else this.queue.push(e)}done(){if(this.isDone=!0,this.readResolve){let e=this.readResolve;this.readResolve=void 0,this.readReject=void 0,e({done:!0,value:void 0})}}error(e){if(this.hasError=e,this.readReject){let t=this.readReject;this.readResolve=void 0,this.readReject=void 0,t(e)}}return(){return this.isDone=!0,this.returned&&this.returned(),Promise.resolve({done:!0,value:void 0})}constructor(e){this.returned=e,this.queue=[],this.isDone=!1,this.started=!1}}function T(e,t,n,s,r){let o=!(arguments.length>5)||void 0===arguments[5]||arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],v=arguments.length>7?arguments[7]:void 0,{data:h,isLoading:y,isError:m,refetch:_}=E(e,o),{streamedMessages:b,interrupt:S,inputStreamRef:w,ensureConnected:I,connectionState:A,lastMessageTime:T}=function(e,t,n,s,r){let o=!(arguments.length>5)||void 0===arguments[5]||arguments[5],u=!(arguments.length>6)||void 0===arguments[6]||arguments[6],g=arguments.length>7?arguments[7]:void 0,v=(0,d.useRef)(null),h=(0,d.useRef)(null),y=(0,d.useRef)(!1),m=(0,d.useRef)(0),_=(0,d.useRef)(null),b=(0,d.useRef)(null),S=(0,d.useRef)(null),[w,I]=(0,d.useState)([]),[A,E]=(0,d.useState)("disconnected"),[T,M]=(0,d.useState)(null),R=(0,p.Tk)(e),D=(0,d.useRef)(e),C=(0,d.useCallback)(()=>{y.current=!0,E("disconnected"),M(null),_.current&&(clearTimeout(_.current),_.current=null),h.current&&(h.current.abort(),h.current=null),S.current&&(S.current.done(),S.current=null),v.current=null,b.current=null,m.current=0},[]);(0,d.useEffect)(()=>{D.current!==e&&(C(),I([]),E("disconnected"),M(null),m.current=0,D.current=e)},[e,C]);let{activeOrganization:P}=(0,i.YL)(),G=null==P?void 0:P.uuid,Q=(0,l.useQueryClient)(),q=(0,d.useRef)(r);q.current=r;let V=(0,d.useCallback)(()=>{var t;if(!o||!G||!e||v.current&&b.current===e)return;C(),y.current=!1,E("connecting"),b.current=e,h.current=new AbortController,S.current=new L;let r=(0,c.P)({prompt:S.current,websocket:{url:x(G,e)},abortController:h.current,mcpServers:s,canUseTool:q.current?(t=q.current,async(e,n,s)=>{var r;if("AskUserQuestion"!==e){let[t,n,s]=e.split("__");if("mcp"!==t||!n||!s)return{behavior:"deny",message:"Invalid tool name format"}}let i=await t(e,n,s);return k(e,null!=(r=i.updatedInput)?r:n,i.decision)}):void 0});(null==g?void 0:g.maxThinkingTokens)!==void 0&&r.setMaxThinkingTokens(g.maxThinkingTokens);let i=null;(async()=>{var e,t,n;try{let n=new Map,s=!0;for await(let o of(i=setTimeout(()=>{s&&E("connected")},500),r)){if(s&&(s=!1,clearTimeout(i),m.current=0,E("connected")),M(Date.now()),I(e=>o.uuid&&e.some(e=>e.uuid===o.uuid)?e:[...e,{...o,receivedStreamAt:Date.now()}]),"assistant"===o.type&&"message"in o){let t=null==(e=o.message)?void 0:e.content;if(Array.isArray(t))for(let e of t)"tool_use"===e.type&&e.id&&e.name&&n.set(e.id,{name:e.name,id:e.id,input:e.input})}if("user"===o.type&&"message"in o){let e=null==(t=o.message)?void 0:t.content;if(Array.isArray(e)){for(let t of e)if("tool_result"===t.type&&t.tool_use_id){let e=n.get(t.tool_use_id),s=(null==e?void 0:e.name)==="mcp__git__git_push",r=(null==e?void 0:e.name)==="Bash"&&function(e){if(!e||"object"!=typeof e)return!1;let t=e.command;return"string"==typeof t&&/^\s*git\s+push\b/.test(t)}(e.input);(s||r)&&Q.invalidateQueries({queryKey:[a.i8],refetchType:"all"})}}}}}catch(s){i&&clearTimeout(i);let e=y.current,t=null==(n=h.current)?void 0:n.signal.aborted;if(y.current=!1,v.current===r&&(E("disconnected"),v.current=null),u&&!e&&!t&&s instanceof Error&&"WebSocket connection aborted by user"!==s.message){let e=m.current;if(e<5){m.current=e+1;let t=1e3*Math.pow(2,e),n=Math.random()*t*.5;_.current=setTimeout(()=>{V()},t+n)}}}})(),v.current=r,n(e=>{var t;v.current===r&&(null==(t=S.current)||t.enqueue(e))})},[o,G,e,C,n,u,s,Q,null==g?void 0:g.maxThinkingTokens]);return(0,d.useEffect)(()=>()=>C(),[C]),(0,d.useEffect)(()=>{if(!T||"connected"!==A||(0,f.m)(w,R))return;let e=3e5-(Date.now()-T);if(e<=0)return void C();let t=setTimeout(()=>{C()},e);return()=>{clearTimeout(t)}},[T,A,w,R,C]),{streamedMessages:w,interrupt:(0,d.useCallback)(()=>{v.current&&(y.current=!0,v.current.interrupt())},[]),inputStreamRef:S,ensureConnected:(0,d.useCallback)(()=>{v.current||(m.current=0,V())},[V]),connectionState:A,lastMessageTime:T}}(e,t,(0,d.useCallback)(async e=>{var t;let n=await _(),s=new Set;if(null==(t=n.data)?void 0:t.data)for(let e of n.data.data)e.uuid&&s.add(e.uuid);return Y.current.forEach(t=>{t.uuid&&!s.has(t.uuid)&&e(t)}),n},[_]),n,s,o&&!m,g,v),M=(0,p.Tk)(e),R=(0,p.jT)(),D=(0,p.Ou)(e=>e.removePendingMessage),C=(0,p.Ou)(e=>e.clearPendingMessages),P=(0,d.useMemo)(()=>{if(y||!h)return[];let e=new Set;return h.data.filter(t=>!(!t.uuid||e.has(t.uuid))&&(e.add(t.uuid),!0))},[y,h]),G=(0,d.useMemo)(()=>{let e=new Map;for(let t of P)t.uuid&&e.set(t.uuid,t);for(let t of b)t.uuid&&e.set(t.uuid,t);return Array.from(e.values())},[P,b]);(0,d.useEffect)(()=>{for(let t of G)t.uuid&&D(e,t.uuid)},[G,e,D]);let Q=(0,d.useCallback)(t=>{var n;let s={uuid:(0,u.b)(),type:"user",session_id:e,parent_tool_use_id:null,message:{role:"user",content:t}};R(e,s),null==(n=w.current)||n.enqueue(s)},[R,e,w]),q=(0,d.useCallback)((e,t,n)=>{var s;let r={type:"control_response",response:{subtype:"success",request_id:e,response:k(e,t,n)}};null==(s=w.current)||s.enqueue(r)},[w]),V=(0,d.useMemo)(()=>{if(0===M.length)return[];let e=new Set;for(let t of G)e.add(t.uuid);return M.filter(t=>!e.has(t.uuid))},[M,G]),Y=(0,d.useRef)([]);Y.current=V,(0,d.useEffect)(()=>{(r||V.length>0)&&I()},[I,r,V.length]);let z=(0,d.useCallback)(()=>{S(),C(e)},[S,C,e]),O=(0,d.useCallback)(()=>{S(),setTimeout(()=>{I()},100)},[S,I]),K=(0,d.useMemo)(()=>(0,f.m)(G,M),[G,M]);return{loadingInitialMessages:y,initialMessagesError:m,sendMessage:Q,sendToolDecision:q,stopSession:z,initialMessages:null==h?void 0:h.data,streamedMessages:b,messages:G,pendingMessages:V,ensureConnected:I,connectionState:A,lastMessageTime:T,retry:O,isSessionRunning:K}}function k(e,t,n){let s;return"deny"===n?{behavior:"deny",message:"Denied by user"}:("always"===n&&(s=[{type:"replaceRules",rules:[{toolName:e}],behavior:"allow",destination:"localSettings"}]),{behavior:"allow",updatedInput:t,updatedPermissions:s})}function M(){let{activeOrganization:e}=(0,i.YL)(),{track:t}=(0,s.st)(),n=(0,r.L2)("/api/organizations/".concat(null==e?void 0:e.uuid,"/sessions"),"POST",{enabled:!!e,onSuccess:e=>{t({event_key:"claudeai.yukon_gold.session_created",session_id:e.session_id})}});return(0,d.useCallback)(e=>{let{model:t,conversationUuid:s,mcpTools:r}=e;return n.mutateAsync({title:"",config_id:"yukon_gold",model:t,conversation_uuid:s,mcp_tools:r})},[n])}function R(){let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)(e=>{let{sessionId:n}=e;return"/api/organizations/".concat(t,"/sessions/").concat(n,"/update")},"POST",{enabled:!!t})}},0xe6c3f31e:(e,t,n)=>{function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"remote";return"local"===n?function(e){if(0===e.length)return!1;for(let t=e.length-1;t>=0;t--){let n=e[t];if((null==n?void 0:n.type)==="result")break;if((null==n?void 0:n.type)==="user")return!r(n)&&!function(e){var t,n,s;let r=null==(t=e.message)?void 0:t.content;return("string"==typeof r?r:Array.isArray(r)&&null!=(s=null==(n=r[0])?void 0:n.text)?s:"").includes("<local-command-stdout>")}(n);if((null==n?void 0:n.type)==="assistant")return!i(n)}return!1}(e):t.length>0||function(e){let t=e.filter(e=>"env_manager_log"!==e.type),n=t[t.length-1];return!n||"result"!==n.type&&("user"===n.type?!r(n):"assistant"!==n.type||!i(n))}(e)}function r(e){var t,n,s;let r=null==(t=e.message)?void 0:t.content;if(Array.isArray(r)){let e=null!=(s=null==(n=r[0])?void 0:n.text)?s:"";return"[Request interrupted by user]"===e||"[Request interrupted by user for tool use]"===e}return!1}function i(e){var t,n;if(e.isApiErrorMessage||(null==(t=e.message)?void 0:t.stop_reason)==="end_turn")return!0;let s=null==(n=e.message)?void 0:n.content;if(Array.isArray(s)&&s.length>0){let e=s[s.length-1];if((null==e?void 0:e.type)==="text")return!0}return!1}n.d(t,{m:()=>s})},0x18175ce17:(e,t,n)=>{n.d(t,{Cg:()=>V,Dd:()=>L,FZ:()=>x,LN:()=>w,TI:()=>R,X0:()=>z,Ys:()=>Q,dJ:()=>C,eL:()=>T,fe:()=>O,hm:()=>M,kO:()=>G,ob:()=>Y,ph:()=>A,qi:()=>D,tS:()=>S,vm:()=>P,xc:()=>I,z3:()=>E});var s=n(0x17aa9d8d7),r=n(0x12c9046cd),i=n(0x14de19ae8),a=n(0x139b5e710),o=n(0x1016c6ed2),u=n(0x49fac030),c=n(0xac309a83),l=n(0x1b813d90),d=n(0x1bd175d8c),p=n(0x78b33fbd),f=n(0x17e725145),g=n(0x4d348f95),v=n(0xfc89b4a4),h=n(0x1ab0d1ca1),y=n(0x21fe74567),m=n(0x4d9fc74e),_=n(0xe824fb1c),b=n(0xc6857cab);let S=e=>e.type===l.v8.GITHUB?{sync_source_type:l.v8.GITHUB,sync_source_config:e.config}:e.type===l.v8.GDRIVE?{sync_source_type:l.v8.GDRIVE,sync_source_config:e.config}:null,w=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/sync/settings"),{queryKey:[u._V,{orgUuid:t}],enabled:!!e})},I=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,s=(0,f.useQueryClient)();return(0,r.Qv)("/api/organizations/".concat(n,"/sync/settings"),"PUT",(e,t)=>{let{type:n,enabled:s}=e;t||(t=[]);let r=t.map(e=>e.type===n?{...e,enabled:s}:e);return r.some(e=>e.type===n)?r:[...t,{type:n,enabled:s}]},{queryKey:[u._V,{orgUuid:n}],enabled:!!t,onSuccess:async function(){for(var t,r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];await s.invalidateQueries({queryKey:[u._V,{orgUuid:n}]}),await (null==(t=e.onSuccess)?void 0:t.call(e,...i))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},A=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,s=(0,f.useQueryClient)(),a=(0,c.fS)("kingfisher_enabled"),o=(0,c.fS)("apps_use_bananagrams"),l=(0,p.useLayer)("trials_freemium").get("free_integrations",!1);return(0,r.Qv)("/api/organizations/".concat(n,"/sync/settings/config"),"POST",(e,t)=>{let{type:n,config:s}=e;return t||(t=[]),t.map(e=>e.type===n?{...e,config:{...e.config,...s}}:e)},{queryKey:[u._V,{orgUuid:n}],enabled:!!(t&&(a||l)&&o),onSuccess:async function(){for(var t,r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];await s.invalidateQueries({queryKey:[u._V,{orgUuid:n}]}),await (null==(t=e.onSuccess)?void 0:t.call(e,...i))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},x=e=>{let{callerIdentifier:t,successParam:n,handleOpen:s}=e,r=(0,g.useSearchParams)(),i=(0,v.useRef)(!1);(0,v.useEffect)(()=>{!r.has(n)||i.current||t&&t!==r.get(n)||(i.current=!0,((e,t)=>{let n=new URLSearchParams(Array.from(t.entries()));n.delete(e);let s=n.toString()?"?".concat(n.toString()):"",r=window.location.pathname+s;window.history.replaceState({...window.history.state,as:r,url:r},"",r)})(n,r),s())},[r,t,s,n])},E=e=>{let t;return t=e.status.state,[l.I5.CREATED,l.I5.PENDING,l.I5.UPDATING].includes(t)},L=e=>[l.I5.FAILED,l.I5.UPDATE_FAILED].includes(e.status.state),T=()=>{let{addError:e}=(0,a.Y)(),t=(0,f.useQueryClient)();return(n,s)=>{(e=>{if(e instanceof o.LG)return e instanceof o.LG&&"access_denied"===e.errorCode})(n)&&(e("Please try again. You may need to reconnect with your ".concat(l.sb[s.sync_source_type]," account."),{error:n}),u.ku.forEach(e=>{t.invalidateQueries({queryKey:[e]})}),t.invalidateQueries({queryKey:[u.GC]}))}},k={[l.v8.GCAL]:"enabled_foccacia",[l.v8.GMAIL]:"enabled_sourdough"},M=e=>{let t=(0,i.mV)(),{data:n}=w(),s=!!(Array.isArray(n)&&n.find(t=>t.type===e&&t.enabled));return!t||s},R={"https://mcp-server-gcal-586545259222.us-central1.run.app/sse":l.v8.GCAL,"https://mcp-server-gcal-586545259222.us-central1.run.app/mcp":l.v8.GCAL,"https://gcal.mcp.claude.com/mcp":l.v8.GCAL,"https://gcal.mcp.staging.ant.dev/mcp":l.v8.GCAL,"https://mcp-server-gmail-110131437935.us-central1.run.app/sse":l.v8.GMAIL,"https://mcp-server-gmail-110131437935.us-central1.run.app/mcp":l.v8.GMAIL,"https://gmail.mcp.claude.com/mcp":l.v8.GMAIL,"https://gmail.mcp.staging.ant.dev/mcp":l.v8.GMAIL,"https://api.anthropic.com/mcp/gdrive/sse":l.v8.GDRIVE,"https://api.anthropic.com/mcp/gdrive/mcp":l.v8.GDRIVE,"https://api-staging.anthropic.com/mcp/gdrive/sse":l.v8.GDRIVE,"https://api-staging.anthropic.com/mcp/gdrive/mcp":l.v8.GDRIVE},D=e=>{let t;return t=(0,_.Uz)({type:"remote"}),t.find(t=>t.url&&R[t.url]===e)},C=e=>!!D(e),P=()=>(0,c.fS)("enabled_brioche"),G=()=>(0,c.fS)("mcp_gdrive"),Q=e=>{let t=P(),n=G(),s=M(e),r=(e=>{let t="cinnabon_enabled";switch(e){case l.v8.GCAL:case l.v8.GMAIL:t="pumpernickel_enabled";break;case l.v8.GDRIVE:t="kingfisher_enabled";break;default:t="cinnabon_enabled"}let n=(0,c.fS)(t),s=(0,p.useLayer)("trials_freemium").get("free_integrations",!1),r=n||(e===l.v8.GCAL||e===l.v8.GMAIL||e===l.v8.GDRIVE)&&s;return!b.env.NEXT_PUBLIC_DISABLE_INTEGRATIONS&&r})(e),i=C(e),a=e===l.v8.GDRIVE?n:t;return!!(r&&(s||a&&i))},q=e=>"sfdc"===e?"salesforce":"gdrive"===e?"mcp/drive":e,V=e=>{let t=D(e);return t?{isFetched:!0,isAuthenticated:!!t.isConnected,server_uuid:t.uuid}:{isFetched:!1,isAuthenticated:!1,server_uuid:void 0}},Y=function(e){let{callerIdentifier:t,handleAuthSuccess:n,pathname:s,queryString:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=G(),c=P(),p=e===l.v8.GDRIVE?u:c,_=((e,t)=>{let{pathname:n,queryString:s,callerIdentifier:r}=t,i=D(e),a=Q(e),o=V(e),u=r?"".concat(e,"_success=").concat(r).concat(s?"&".concat(s):""):s,c=(0,m.Q)({pathname:n,queryString:u});return{isAuthenticated:!!a&&!!i&&o.isAuthenticated,startAuth:()=>{a&&i&&c({uuid:i.uuid,url:i.url})},disconnect:()=>{},isFetched:!!i&&o.isFetched}})(e,{pathname:s,queryString:o,callerIdentifier:t}),{activeOrganization:b}=(0,i.YL)(),S=null==b?void 0:b.uuid,w=(0,g.usePathname)(),I=(0,g.useSearchParams)(),{addSuccess:A}=(0,a.Y)(),E=(0,h.A)(),L=Q(e),T=(0,f.useQueryClient)(),k=(0,d.V)(),{data:M,isFetched:R}=(0,r.Sk)("/api/organizations/".concat(S,"/sync/").concat(q(e),"/auth"),{queryKey:["sync_".concat(e,"_auth_status"),{orgUuid:S}],enabled:!!(b&&L)}),C=(0,v.useRef)(!1),{mutate:Y}=(0,r.L2)("/api/organizations/".concat(S,"/sync/").concat(q(e),"/auth/start"),"POST",{enabled:!!(b&&L)&&!p,onSuccess:e=>{window.location.href=e.redirect_url}});x({callerIdentifier:t,successParam:"".concat(e,"_success"),handleOpen:()=>{A(E.formatMessage({defaultMessage:"Connected to {integrationName}",id:"g0plFfAZAH"},{integrationName:l.sb[e]})),null==n||n(!0)}});let{mutate:z}=(0,r.L2)("/api/organizations/".concat(S,"/sync/").concat(q(e),"/auth"),"DELETE",{enabled:!!(b&&L)&&!p,onSuccess:()=>{T.invalidateQueries({queryKey:["sync_".concat(e,"_auth_status"),{orgUuid:S}]})}});return p&&_.isFetched?{..._,authBreakdown:{mcp:L&&_.isAuthenticated,firstParty:L&&!!(null==M?void 0:M.is_authenticated)},mcpServerGated:p}:{isAuthenticated:L&&!!(null==M?void 0:M.is_authenticated),startAuth:()=>{if(!C.current&&L){let n="".concat(e,"_success=").concat(t).concat(o?"&".concat(o):""),r=(0,y.d)({pathname:s||w,searchParams:I,queryString:n,shouldOpenInClaudeApp:k});if(k){window.location.href="/settings/connectors?open_in_browser=1&auth_start=".concat(e,"&origin=").concat(r);return}C.current=!0,Y({pre_auth_state:{origin:r},redirect_uri:new URL("/connect/".concat(q(e),"/callback"),window.location.origin).toString()})}},disconnect:z,isFetched:R,authBreakdown:{mcp:L&&_.isAuthenticated,firstParty:L&&!!(null==M?void 0:M.is_authenticated)},mcpServerGated:p}},z=(e,t)=>{var n,s;let r=P(),a=G(),o=e===l.v8.GDRIVE?a:r,u=Q(e),{account:c}=(0,i.YL)(),d=k[e];return!d||o?u:u&&(t?!!(null==t||null==(n=t.conversationSettings)?void 0:n[d]):!!(null==c||null==(s=c.settings)?void 0:s[d]))},O=()=>{let{account:e}=(0,i.YL)(),{mutate:t}=(0,s.yJ)();return{toggleIntegrationEnabled:(n,s)=>{if(!e)return;let r=k[n];r&&t({[r]:s})}}}},0x21687185c:(e,t,n)=>{n.d(t,{Ou:()=>i,Tk:()=>u,jT:()=>a});var s=n(0x394ef833),r=n(0x16784b660);let i=(0,s.v)()((0,r.Zr)(e=>({pendingMessages:{},addPendingMessage:(t,n)=>{e(e=>({pendingMessages:{...e.pendingMessages,[t]:[...e.pendingMessages[t]||[],n]}}))},clearPendingMessages:t=>{e(e=>({pendingMessages:{...e.pendingMessages,[t]:[]}}))},removePendingMessage:(t,n)=>{e(e=>({pendingMessages:{...e.pendingMessages,[t]:(e.pendingMessages[t]||[]).filter(e=>e.uuid!==n)}}))}}),{name:"session-pending-messages",storage:(0,r.KU)(()=>sessionStorage)})),a=()=>i(e=>e.addPendingMessage),o=[],u=e=>i(t=>{var n;return null!=(n=t.pendingMessages[e])?n:o})}}]);